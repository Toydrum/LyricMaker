<section>
<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <div formArrayName="lines">
    @for (ctrl of lines.controls; let i = $index; track i) {
      <div [formGroupName]="i" class="line">
        <input type="number" formControlName="lineNumber" readonly />

        <!-- Usamos el componente hijo; sincronizamos con el form control -->
        <app-generic-line
          [lineNumber]="ctrl.controls.lineNumber.value"
          [content]="ctrl.controls.content.value"
          (contentChange)="onContentChange(i, $event)"
        ></app-generic-line>

        <button type="button" (click)="removeLine(i)">Remove</button>

        <div class="error" *ngIf="ctrl.controls.content.touched && ctrl.controls.content.invalid">
          <small *ngIf="ctrl.controls.content.hasError('required')">Content is required.</small>
          <small *ngIf="ctrl.controls.content.hasError('minlength')">Too short.</small>
        </div>
      </div>
    } @empty {
      <p>No lines yet</p>
    }
  </div>

  <div class="actions">
    <button type="button" (click)="addLine()">Add line</button>
    <button type="submit" [disabled]="form.invalid">Save</button>
  </div>
</form>
</section>

<!-- Resultado del análisis de sílabas -->
<section *ngIf="analysis?.length">
  <h3>Resultado</h3>
  @for (line of analysis; let i = $index; track i) {
    <div class="line-result">
      <h4>Línea {{ i + 1 }} <small>(Total sílabas: {{ line.total }})</small></h4>
      <div class="words">
        @for (w of line.words; let wi = $index; track wi) {
          <div class="word">
            <div class="word-text">{{ w.text }}</div>
            <div class="syllables">
              @for (s of w.syllables; let si = $index; track si) {
                <span class="syllable-box">{{ s }}</span>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }
  @empty {
    <p>No hay análisis disponible.</p>
  }
</section>
